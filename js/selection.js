"use strict";var appoint_url="https://gzflower.bluej.cn/index/choose/chooselist",access_token=getUrlVal("access_token");access_token||(alert("请登录"),location.href="http://127.0.0.1:8848/20200225appointment%20system/html/index.html");var _ref=[$(".more"),$(".option"),$(".time"),$(".available")];function loadData(e){var s=document.querySelector(".select");e.data.list.forEach(function(e){var t=document.createElement("div"),o=(e.day_time.slice(0,4),e.day_time.slice(5,7)),a=e.day_time.slice(8,10),i="".concat(o,"月").concat(a,"日");t.innerHTML="".concat(i),t.classList.add("option"),s.appendChild(t)}),s.children[0].classList.add("active"),refreshToday(),(s=$(".option")).click(function(e){s.removeClass("option active"),s.addClass("option"),$(this).addClass("active"),refreshToday()})}more_btn=_ref[0],selections=_ref[1],times=_ref[2],availables=_ref[3],$.ajax({url:appoint_url,type:"post",data:{access_token:access_token},timeout:3e3,success:function(e){loadData(e),refreshToday()},error:function(){console.log("error")}}),more_btn.click(function(){console.log("more"),selections=$(".option"),selections.removeClass("option")}),selections.click(function(e){selections.removeClass("option active"),selections.addClass("option"),$(this).addClass("active")});var isClick=!0;function refreshToday(){if($(".option.active").eq(0)[0].classList.value.includes("empty"))for(var e=1;e<4;e++)$("table tr").eq(e)[0].cells[0].innerHTML="-",$("table tr").eq(e)[0].cells[1].innerHTML="-";else{var _=getUrlVal("uname"),t=$(".option.active").text().slice(0,2),o=$(".option.active").text().slice(3,5),h="2019-".concat(t,"-").concat(o);$.ajax({url:"https://gzflower.bluej.cn/index/choose/chooseday",type:"post",data:{access_token:access_token,day_time:h},success:function(e){var t=1;e.data.dayInfo.forEach(function(e){console.log(e),$("table tr").eq(t)[0].cells[0].innerHTML=e.show_name,$("table tr").eq(t)[0].cells[1].innerHTML=0===e.balance?"已约满":"可预约",$("table tr").eq(t).attr("show_id",e.show_id),t++});var n=$(".alert_wrapper"),l=$(".alert_btn_cancel"),r=$(".alert_btn_confirm"),d=$(".alert_content");l.click(function(e){isClick=!0,n.hide()}),availables.on("click",function(e){var t=e.target.attributes.index.value;if("已约满"!=e.target.innerText){if(0!=isClick&&"可预约"==e.target.innerText){var o=isClick=!1,a=times[t].innerText,i=h,s=e.target.parentNode.getAttribute("show_id"),c="温馨提示,是否预约"+i+"场次"+a;l.show(),r.show(),n.show(),d.html(c),r.one("click",function(){o=!0,n.hide(),isClick=!0,o&&$.ajax({url:api.appoint_url,type:"post",data:{access_token:access_token,day_time:i,show_id:s},success:function(e){console.log(e),0==e.res?(isClick=!0,n.find(".alert_content").html("预约失败,当天只能预约一场"),l.hide(),r.hide(),n.show(),setTimeout(function(){n.find(".alert_content").html("预约失败,当天只能预约一场"),n.hide()},2500)):(isClick=!0,MtaH5.clickStat("book_success",{booktime:JSON.stringify(i+" + "+s)}),location.href="welcome.html?access_token="+access_token+"&uname="+escape(_)+"&show_id="+s+"&day_time="+i+"&show_id="+s)}})})}}else isClick=!0})}})}}